# ROADMAP ISO 27001 COMPLIANCE PLATFORM v2.0

## FASE 1: INFRAESTRUCTURA Y SEGURIDAD BASE
**Duración: Semana 1-2**

### 1.1 Configuración de Entorno
- Archivo .env con variables críticas
- Configuración de seguridad PHP
- Estructura de directorios con permisos correctos
- Autoload PSR-4 en composer.json

### 1.2 Core Framework
- Database.php: Singleton PDO con prepared statements
- Router.php: Sistema de rutas con middleware chain
- Request.php: Sanitización automática de inputs
- Response.php: Headers seguros y output encoding
- Session.php: Gestión con regeneración y fingerprinting
- Validator.php: Reglas de validación reutilizables

### 1.3 Middleware de Seguridad
- CsrfMiddleware.php: Generación y validación de tokens
- AuthMiddleware.php: Verificación de sesión
- RateLimitMiddleware.php: Control de requests por IP/usuario
- TenantMiddleware.php: Validación empresa_id obligatoria

### 1.4 Servicios Base
- LogService.php: Logging estructurado con niveles
- FileService.php: Upload seguro con validación MIME
- CacheService.php: Sistema de caché con TTL

---

## FASE 2: BASE DE DATOS NORMALIZADA
**Duración: Semana 2**

### 2.1 Schema SQL
- Tablas en 3FN con constraints
- Índices optimizados para queries frecuentes
- Foreign keys con CASCADE apropiado
- Triggers para audit_logs

### 2.2 Migraciones
- Sistema de versionado de BD
- Scripts de migración incremental
- Rollback automático en fallo

### 2.3 Seeds
- Datos maestros: controles ISO 27001
- Dominios de controles
- Requerimientos base obligatorios
- Usuario super_admin inicial

---

## FASE 3: MULTI-TENANCY ESTRICTO
**Duración: Semana 3**

### 3.1 Tenant Context
- Clase singleton TenantContext
- Inyección automática de empresa_id
- Validación IDOR en cada query

### 3.2 Base Model con Scope
- Model.php con scope automático por tenant
- SoftDelete.php trait para eliminación lógica
- Timestamps automáticos

### 3.3 Repository Pattern
- Repository.php base con métodos CRUD seguros
- Transacciones para operaciones complejas
- Caché de queries frecuentes

---

## FASE 4: AUTENTICACIÓN Y AUTORIZACIÓN
**Duración: Semana 3-4**

### 4.1 Sistema de Registro Multi-Tenant
- Wizard 3 pasos: Empresa, Admin, Confirmación
- Transacción atómica: empresa + usuario + SOA inicial
- Validación RUC único

### 4.2 Sistema de Login
- AuthService.php con hash Argon2id
- Rate limiting 5 intentos/15min
- Session fingerprinting
- Regeneración de session_id

### 4.3 Control de Acceso
- RoleMiddleware.php con permisos por rol
- Roles: super_admin, admin_empresa, auditor, consultor
- Validación de permisos antes de cada acción

---

## FASE 5: MÓDULO DE CONTROLES
**Duración: Semana 4-5**

### 5.1 Modelo y Repositorio
- Control.php model
- SOA.php model con relación a empresa
- ControlRepository.php con queries optimizados

### 5.2 Controladores
- ControlController.php con CRUD completo
- Validación de aplicabilidad
- Estados: implementado, parcial, no_implementado

### 5.3 Vistas
- Lista de controles con filtros
- Detalle con formulario de evaluación
- Dashboard de cumplimiento por dominio

---

## FASE 6: MÓDULO GAP ANALYSIS
**Duración: Semana 5-6**

### 6.1 Modelo y Lógica de Negocio
- Gap.php model con validaciones
- Accion.php model relacionado
- Cálculo automático de avance

### 6.2 Controladores
- GapController.php con validación de controles aplicables
- Solo permite GAPs en controles no implementados
- Soft delete en cascada

### 6.3 Vistas
- Formulario de creación con acciones dinámicas
- Vista de detalle con progreso visual
- Lista con filtros por prioridad y estado

---

## FASE 7: MÓDULO DE EVIDENCIAS
**Duración: Semana 6-7**

### 7.1 Upload Seguro
- Validación MIME real con finfo
- Escaneo anti-malware básico
- Almacenamiento organizado: /uploads/empresa_id/año/mes/
- Nombres únicos con hash SHA256

### 7.2 Gestión de Evidencias
- EvidenciaController.php con validación IDOR
- Estados: pendiente, aprobada, rechazada
- Descarga con rate limiting

### 7.3 Vistas
- Formulario de subida
- Repositorio con filtros
- Modal de validación para auditores

---

## FASE 8: MÓDULO DE REQUERIMIENTOS
**Duración: Semana 7**

### 8.1 Completitud Automática
- Trigger o cron para verificación
- Validación: todos los controles + todas las evidencias
- Actualización de estado automática

### 8.2 Controlador y Vistas
- RequerimientoController.php
- Checklist de 7 requerimientos obligatorios
- Vista de progreso con barra visual

---

## FASE 9: DASHBOARD Y MÉTRICAS
**Duración: Semana 8**

### 9.1 MetricsService
- Cálculos con caché 5 minutos
- Queries optimizados con índices
- Agregaciones en BD

### 9.2 DashboardController
- Cards: cumplimiento, gaps, evidencias, acciones
- Gráficos: avance por dominio, timeline
- Actualización automática

### 9.3 Vistas
- Dashboard responsive
- Gráficos con Chart.js o similar
- Filtros de fecha

---

## FASE 10: AUDITORÍA Y LOGGING
**Duración: Semana 8**

### 10.1 Audit Logs
- Trigger en tablas críticas
- Registro de before/after values
- IP y user_agent en cada log

### 10.2 Security Logs
- Intentos IDOR
- Rate limit hits
- Login fallidos
- Accesos no autorizados

### 10.3 Reportes de Auditoría
- Exportación de logs
- Filtros por usuario, fecha, acción
- Retención 2 años

---

## FASE 11: OPTIMIZACIÓN DE RENDIMIENTO
**Duración: Semana 9**

### 11.1 Database
- Análisis EXPLAIN en queries lentos
- Índices compuestos
- Connection pooling
- Paginación obligatoria

### 11.2 Caché Agresivo
- Queries agregadas
- Vistas parciales
- Invalidación inteligente

### 11.3 Assets
- Minificación CSS/JS
- Lazy loading de imágenes
- CDN para Tailwind

---

## FASE 12: UI/UX PROFESIONAL
**Duración: Semana 9-10**

### 12.1 Design System
- Variables CSS
- Componentes reutilizables
- Estados visuales consistentes

### 12.2 Responsive Design
- Mobile-first
- Sidebar colapsable
- Tablas adaptativas

### 12.3 Accesibilidad
- Contraste WCAG AA
- Labels y ARIA
- Navegación por teclado

### 12.4 Feedback Visual
- Toasts para notificaciones
- Confirmaciones en acciones destructivas
- Spinners en cargas

---

## FASE 13: TESTING
**Duración: Semana 10**

### 13.1 Unit Tests
- PHPUnit para modelos
- Servicios críticos
- Validaciones

### 13.2 Integration Tests
- Flujos completos
- Transacciones
- Middleware chain

### 13.3 Security Tests
- SQL injection attempts
- XSS payloads
- CSRF bypass
- IDOR exploitation

---

## FASE 14: DEPLOYMENT Y CI/CD
**Duración: Semana 10**

### 14.1 Environment Production
- .env.production
- Permisos correctos
- SSL/TLS
- Firewall

### 14.2 CI Pipeline
- GitHub Actions
- Tests automáticos
- Static analysis
- Security scan

### 14.3 Deployment
- Script automatizado
- Backup previo
- Migrations automáticas
- Rollback en fallo

### 14.4 Monitoring
- Health checks
- Error tracking
- Performance monitoring
- Backup automatizado

---

## ORDEN DE EJECUCIÓN RECOMENDADO

**Semana 1-2:** Fase 1 + Fase 2
**Semana 3:** Fase 3 + Fase 4
**Semana 4-5:** Fase 5 + Fase 6
**Semana 6-7:** Fase 7 + Fase 8
**Semana 8:** Fase 9 + Fase 10
**Semana 9:** Fase 11 + Fase 12
**Semana 10:** Fase 13 + Fase 14

---

Terminado. Esperando confirmación para iniciar Fase 1.
